<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Admin Dashborad</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/img/iStorelogo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <!-- Template CSS -->

    <link rel="stylesheet" href="/admin-assets/css/main.css" type="text/css">
    <link rel="stylesheet" href="/admin-assets/css/user.css">
    <style>
         .order-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 100;
  display: flex;
  justify-content: center;
  align-items: center;
}

.order-modal-content {
  background-color: #000;
  color: #fff;
  padding: 1rem;
  border-radius: 0.5rem;
  max-width: 500px;
}

    </style>


</head>

<body>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="/admin/dashboard" class="brand-wrap">
               <p style="color: black; font-size: x-large; font-weight: 800;"> i Store</p>
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i> </button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item">
                    <a class="menu-link" href="/admin/dashboard"> <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="#"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Menu</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/productList">PRODUCT</a>
                        <a href="/admin/viewcategory">CATEGORY</a>
                        <a href="/admin/userManagement">USER</a>
                        <a href="/admin/coupon">COUPON</a>
                        <a href="/admin/banner">BANNER</a>
                        <a href="/admin/offerList">OFFER</a>
                    </div>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/orderList"> <i class="icon material-icons md-local_shipping"></i>
                        <span class="text">Order</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/salesReport"><i class="icon material-icons md-insert_drive_file"></i>
  
                        <span class="text">Sales Report</span>
                    </a>
                </li>
                
            <hr>
            
               
                <li class="menu-item">
                    <a class="menu-link" href="/admin/logout"> <i class="icon fa fa-sign-out"></i>
                        <span class="text"> Logout </span>
                    </a>
                </li>
         
            <br>
            <br>
        </nav>
    </aside>

    <main class="main-wrap">
        
        <section class="content-main">
            <div class="row">
               
              <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Order Details </h2>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-4">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-primary"><i class="text-white material-icons md-person"></i></span>

                            <div class="text">
                                <h6 class="mb-1 card-title">Customer Info</h6> 
                                <span>
                                    <ul>
                                        <li><p>NAME: <%-orderDetail.address.name %></p></li>
                                        <li><p>MOBILE: <%-orderDetail.address.mobile %></p></li>
                                       
                                    </ul>

                                </span>
                              
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-local_shipping"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Order Info</h6> 
                                <span>
                                    <ul>
                                        <li><p>ID: <%-orderDetail.ord %></p></li>
                                        <li><p>STATUS: <%-orderDetail.orderStatus %></p></li>
                                        <li><p>PAYMENT: <%-orderDetail.paymentMethod %></p></li>
                                    </ul>

                                </span>
                               
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                          <span class="icon icon-sm rounded-circle bg-warning-light"><i class="fa-solid fa-location-dot fa-sm"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Delivery Info</h6> 
                                <span>
                                  <ul>
                                      <li><p>CITY: <%-orderDetail.address.city %></p></li>
                                      <li><p>STREET: <%-orderDetail.address.street %></p></li>
                                      <li><p>PINCODE: <%-orderDetail.address.postalCode %></p></li>
                                  </ul>
  
                              </span>
                                
                            </div>
                        </article>
                    </div>
                </div>
             
               
               
               
            </div>
            <div class="row">
                <div class="col-lg-8">
                <table class="table">
                    <thead class="thead-dark">
                      <tr>
                        <th scope="col">Product</th>
                        <th scope="col">Status</th>
                        <th scope="col">Quantity</th>
                        <th scope="col">Unit Price</th>
                        <th scope="col">Total</th>
                      </tr>
                    </thead>
                    <tbody>
                        <% for( let i=0; i < orderDetail.products.length; i++ ) { %>
                      <tr>
                        <td><%-orderDetail.products[i].productId.productName %></td>
                        <td>
                        <%-orderDetail.products[i].productStatus %> <br>
                        <span style="font-size: smaller;"> REASON: <%-orderDetail.products[i].returnReason %> </span>
                        </td>
                        <td><%-orderDetail.products[i].quantity %></td>
                        <td><%-orderDetail.products[i].salePrice %></td>
                        <td><%-orderDetail.products[i].total %></td>
                      </tr>
                     
                      <% } %>
                      <tr>
                      
                        <td colspan="4" style="color: #000; font-size: medium; text-align: end;">Coupon</td>
                        <td  style="color: red; font-size: medium;"><%- orderDetail.couponDiscountAmount.toFixed(2) %></td>

                      </tr>
                      <tr>
                       
                       
                        <td colspan="4" style="color: #000; font-size: medium; text-align: end;">Grand Total</td>
                        <td  style="color:red; font-size: medium;"><%- orderDetail.actualTotalAmount.toFixed(2) %></td>

                      </tr>
                    </tbody>
                  </table>
                  <div>
                    <a href="/admin/orderList" class="btn btn-primary"> Back To List</a>
                  </div>
                </div>
                <div class="col-lg-4">
                    <div class="card card-body mb-4">
                        <div class="text">
                            <h6 class="mb-1 card-title mb-4"> <i class="fa-regular fa-bell fa-beat-fade fa-lg" style="color: #eb1e1e;"></i> &nbsp;ORDER STATUS </h6>
                            
                            <form>
                                <div class="form-group">
                                        <% if(orderDetail.orderStatus=="Order Placed"){ %>
                                        <select class="form-control" id="statusShipped">
                                        <option value="" disabled selected hidden>Select a Status</option>                                  
                                        <option value="Shipped">Shipped</option>
                                        </select>
                                        <button type="button" class="btn btn-primary mt-4" id="btnshipped" onclick="statusshipped('<%-orderDetail._id %>')" >Save Status</button>
                                        <% } else if(orderDetail.orderStatus=="Shipped"){ %>
                                            <select class="form-control" id="statusDelivered">
                                                <option value="" disabled selected hidden>Select a Status</option>                                  
                                                <option value="Delivered">Delivered</option>
                                                </select>
                                                <button type="button" class="btn btn-primary mt-4" id="saveStatusBtn" onclick="statusdelivered('<%-orderDetail._id %>')" >Save Status</button>

                                        <% } else if(orderDetail.orderStatus=="Delivered"){ %>

                                            <% if(orderDetail.returnOrderStatus.status=="Not requested"){ %>
                                              <span>RETURN STATUS:</span>  
                                              <span style="color: rgb(9, 119, 9);"> <%-orderDetail.returnOrderStatus.status %></span>
                                
                                            <% }else if(orderDetail.returnOrderStatus.status=="Requested For Return"){ %>

                                                <span style="font-size: smaller;">STATUS:</span>  
                                                <span style="color: rgb(230, 27, 27); font-size: smaller;"> <%-orderDetail.returnOrderStatus.status%></span><br>
                                                <span style="font-size: smaller;">PRODUCTS: </span>
                                                <% for(let i=0 ;i< orderDetail.products.length ;i++){ %>
                                                
                                                <% if(orderDetail.products[i].productStatus=="Return Requested" ) {%>
                                                   
                                                    <span style="font-size: smaller;"><%- orderDetail.products[i].productId.productName %></span> &nbsp;
                                                    <% } %>
                                                    <% } %>
                                                <br>
                                                <span style="font-size: smaller;">REASON: </span>
                                                <span style="font-size: smaller;"><%-orderDetail.returnOrderStatus.reason %></span>
                                                <select class="form-control mt-2" id="returnApproved">
                                                <option value="" disabled selected hidden>Select a Status</option>                                  
                                                <option value="Return Approved">Request Approved</option>
                                                </select>
                                                <button type="button" class="btn btn-primary mt-4" id="returnStatusBtn" onclick="returnApprovalStatus('<%-orderDetail._id %>')" >Save Status</button>
                                            <% }else if(orderDetail.returnOrderStatus.status=="Return Approved"){ %>
                                                <span>RETURN STATUS:</span>  
                                                <span style="color: rgb(9, 119, 9);"> <%-orderDetail.returnOrderStatus.status %></span>
                                                <select class="form-control mt-2" id="returnConfirmed">
                                                    <option value="" disabled selected hidden>Select a Status</option>                                  
                                                    <option value="Product Returned">Return Confirmed </option>
                                                    </select>
                                                    <button type="button" class="btn btn-primary mt-4" id="returnconfirmBtn" onclick="returnConfirmStatus('<%-orderDetail._id %>')" >Save Status</button>
                                                <% }else{ %>
                                                    <span>Not Available</span>
                                                    <% } %>

                                    <% }else{ %>
                                        <span>Not Available</span>
                                        <% } %>
                                        
                                
                                </div>                              
                        
                            </form>
                        </div>
                    </div>
                    
                </div>
            </div>
            
    
      
          
         </div>
        </section> <!-- content-main end// -->
        <footer class="main-footer font-xs">
            <div class="row pb-30 pt-15">
                <div class="col-sm-6">
                    <script>
                    document.write(new Date().getFullYear())
                    </script> ©, Evara - HTML Ecommerce Template .
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end">
                        All rights reserved
                    </div>
                </div>
            </div>
        </footer>
    </main>
    <script src="/admin-assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/admin-assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/admin-assets/js/vendors/select2.min.js"></script>
    <script src="/admin-assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/admin-assets/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="/admin-assets/js/vendors/chart.js"></script>
    <!-- Main Script -->
    <script src="/admin-assets/js/main.js" type="text/javascript"></script>
    <script src="/admin-assets/js/custom-chart.js" type="text/javascript"></script>

    <!-- item shiped -->

    <script>
      
        async function statusshipped(orderId){
            let selectedValue=document.getElementById("statusShipped").value
            console.log('orderId:',orderId);
            console.log('status',selectedValue);
            if(selectedValue){
                const data={
                    orderStatus:selectedValue,
                    orderId:orderId
                }
                const response = await fetch('/admin/shipped', {
                    method: 'post',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                const result = await response.json();
                if (result.status === 'success') {
                    showModalMessage(result.message)
                    setTimeout(() => {
                        location.href = '/admin/orderList'
                    }, 1500)
                }else{
                    showModalMessage(result.message)
                }

            }else{
                showModalMessage("Select a Status")
            }
        }

        function showModalMessage(message) {
        // Create a modal element with the message and the specified icon
        const modal = document.createElement("div");
        modal.classList.add("order-modal"); // Apply appropriate styling through CSS
        const modalContent = document.createElement("div");
        modalContent.classList.add("order-modal-content");
        modalContent.innerHTML = ` ${message}`;
    
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        // Center the icon and message vertically and horizontally
        modal.style.textAlign = "center";
        // Remove the modal after a few seconds (you can customize the timing)
        setTimeout(() => {
          document.body.removeChild(modal);
        }, 1500); // 3 seconds in this example
      }

    </script>




    <!-- item delivered -->
    <script>
      
        async function statusdelivered(orderId){
            let selectedValue=document.getElementById("statusDelivered").value
            //console.log('orderId:',orderId);
            if(selectedValue){
                const data={
                    orderStatus:selectedValue,
                    orderId:orderId
                }
                const response = await fetch('/admin/delivered', {
                    method: 'post',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                const result = await response.json();
                if (result.status === 'success') {
                    showModalMessage(result.message)
                    setTimeout(() => {
                        location.href = '/admin/orderList'
                    }, 1500)
                }else{
                    showModalMessage(result.message)
                }

            }else{
                showModalMessage("Select a Status")
            }
        }

        function showModalMessage(message) {
        // Create a modal element with the message and the specified icon
        const modal = document.createElement("div");
        modal.classList.add("order-modal"); // Apply appropriate styling through CSS
        const modalContent = document.createElement("div");
        modalContent.classList.add("order-modal-content");
        modalContent.innerHTML = ` ${message}`;
    
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        // Center the icon and message vertically and horizontally
        modal.style.textAlign = "center";
        // Remove the modal after a few seconds (you can customize the timing)
        setTimeout(() => {
          document.body.removeChild(modal);
        }, 1500); // 3 seconds in this example
      }

    </script>

<!-- Item retun approval -->
<script>
    async function returnApprovalStatus(orderId){
        let selectedValue=document.getElementById("returnApproved").value
        console.log('selectedvalue:',selectedValue);
        if(selectedValue){
            const data={
                returnStatus:selectedValue,
                orderId:orderId
            }
            console.log('data',data);

            const response = await fetch('/admin/returnApporval', {
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            const result = await response.json();
            if (result.status === 'success') {
                showModalMessage(result.message)
                setTimeout(() => {
                    location.href = '/admin/orderList'
                }, 1500)
            }else{
                showModalMessage(result.message)
            }

        }else{
            showModalMessage("Select a Status")
        }
    }

    function showModalMessage(message) {
    // Create a modal element with the message and the specified icon
    const modal = document.createElement("div");
    modal.classList.add("order-modal"); // Apply appropriate styling through CSS
    const modalContent = document.createElement("div");
    modalContent.classList.add("order-modal-content");
    modalContent.innerHTML = ` ${message}`;

    modal.appendChild(modalContent);
    document.body.appendChild(modal);
    // Center the icon and message vertically and horizontally
    modal.style.textAlign = "center";
    // Remove the modal after a few seconds (you can customize the timing)
    setTimeout(() => {
      document.body.removeChild(modal);
    }, 1500); // 3 seconds in this example
  }

</script>
<!-- Return confirmation -->
<script>
    async function returnConfirmStatus(orderId){
        let selectedValue=document.getElementById("returnConfirmed").value
        console.log('selectedvalue:',selectedValue);
        if(selectedValue){
            const data={
                returnStatus:selectedValue,
                orderId:orderId
            }
            console.log('data',data);

            const response = await fetch('/admin/returnConfirmed', {
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            const result = await response.json();
            if (result.status === 'success') {
                showModalMessage(result.message)
                setTimeout(() => {
                    location.href = '/admin/orderList'
                }, 1500)
            }else{
                showModalMessage(result.message)
            }

        }else{
            showModalMessage("Select a Status")
        }
    }

    function showModalMessage(message) {
    // Create a modal element with the message and the specified icon
    const modal = document.createElement("div");
    modal.classList.add("order-modal"); // Apply appropriate styling through CSS
    const modalContent = document.createElement("div");
    modalContent.classList.add("order-modal-content");
    modalContent.innerHTML = ` ${message}`;

    modal.appendChild(modalContent);
    document.body.appendChild(modal);
    // Center the icon and message vertically and horizontally
    modal.style.textAlign = "center";
    // Remove the modal after a few seconds (you can customize the timing)
    setTimeout(() => {
      document.body.removeChild(modal);
    }, 1500); // 3 seconds in this example
  }

</script>
    
</body>

</html>